<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notifikasi Admin</title>

  <!-- material icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" />

  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <!-- Global search bar -->
  <header class="topbar" role="banner">
    <div class="search-wrap">
      <input id="globalSearch" class="search-input" type="search" placeholder="Search site..." aria-label="Search">
      <button class="search-btn" type="button" onclick="globalSearch()" aria-label="Search">Search</button>
    </div>
  </header>
  <style>
  .topbar{position:fixed;left:260px;right:0;top:0;height:64px;display:flex;align-items:center;padding:0 18px;background:transparent;z-index:999}
  .search-wrap{max-width:1100px;width:100%;display:flex;gap:8px;background:#ffffff;padding:8px;border-radius:8px}
  .search-input{flex:1;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px;background:#fff}
  .search-btn{padding:8px 12px;border-radius:8px;border:1px solid #e5e7eb;background:#0b63ff;color:#fff;cursor:pointer}
  .kotak,.content,main{margin-top:84px}
  @media(max-width:800px){.topbar{left:0} .kotak,.content,main{margin-left:0}}
  </style>
  <script>
    function globalSearch(){
      const q=document.getElementById('globalSearch').value.trim();
      if(!q) return;
      const found = document.querySelectorAll('body *:not(script):not(style)');
      for(const el of found){
        if(el.textContent && el.textContent.toLowerCase().includes(q.toLowerCase())){
          el.scrollIntoView({behavior:'smooth',block:'center'});
          el.style.outline='3px solid #ffea00';
          setTimeout(()=>el.style.outline='',3000);
          return;
        }
      }
      alert('No results on this page.');
    }
  </script>

  <!-- sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="../../../IMG/PROTON.png" alt="logo">
      <h2>Admin</h2>
    </div>

    <ul class="links main-links">
      <li>
        <span class="material-symbols-outlined">dashboard</span>
        <a href="dashboard.html">Laman Utama</a>
      </li>
      <li>
        <span class="material-symbols-outlined">calendar_month</span>
        <a href="Booking.html">Kemaskini Kalendar</a>
      </li>
      <li class="active">
        <span class="material-symbols-outlined">notifications</span>
        <a href="/admin/pages/main/notification.html">Notifikasi Tempahan</a>
      </li>
      <li>
        <span class="material-symbols-outlined">library_books</span>
        <a href="/admin/pages/main/vehicle.html">Pengurusan Dokumen</a>
      </li>
    </ul>

    <ul class="links bottom-links">
      <li>
        <span class="material-symbols-outlined">person</span>
        <a href="/admin/pages/main/bottom/profile.html">Profil</a>
      </li>
      <li class="logout-link">
        <span class="material-symbols-outlined">logout</span>
        <a href="/admin/pages/main/bottom/logout.html">Log Keluar</a>
      </li>
    </ul>
  </aside>

  <!-- main content -->
  <main class="content ml-[260px] p-6">
    <div class="bg-white shadow-lg rounded-xl p-6 w-full">
      <h2 class="text-xl font-bold mb-4">Senarai Notifikasi Permohonan</h2>

      <table class="w-full border-collapse">
        <thead>
          <tr class="border-b">
            <th class="py-2 text-left">Nama Pemohon</th>
            <th class="py-2 text-left">Status</th>
            <th class="py-2 text-center">Tindakan</th>
            <th class="py-2 text-left">Tarikh</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b">
            <td class="py-3 flex items-center gap-2">
              <img src="https://via.placeholder.com/30" class="rounded-full">
              Irfan Aidil
            </td>
            <td class="text-yellow-600 font-semibold">MENUNGGU</td>
            <td class="text-center">
              <button onclick="openModal('Irfan Aidil','BPPL','2025-10-23','Memo lawatan pelajar','Memohon untuk meminjam van kolej pada 23/10/2025 bagi tujuan menghantar pelajar ke lawatan sambil belajar ke Kilang Honda Alor Gajah.','Van Kolej',this)" class="text-blue-600 hover:text-blue-800">
                üëÅ
              </button>
            </td>
            <td>2025-10-23</td>
          </tr>
          <tr class="border-b">
            <td class="py-3 flex items-center gap-2">
              <img src="https://via.placeholder.com/30" class="rounded-full">
              Puan Natasya
            </td>
            <td class="text-red-600 font-semibold">DITOLAK</td>
            <td class="text-center">
              <button onclick="openModal('Puan Natasya','HEA','2025-09-29','Memo projek pelajar','Permohonan menggunakan kenderaan ditolak kerana jadual bertembung.','Kereta Proton',this)" class="text-blue-600 hover:text-blue-800">
                üëÅ
              </button>
            </td>
            <td>2025-09-29</td>
          </tr>
          <tr class="border-b">
            <td class="py-3 flex items-center gap-2">
              <img src="https://via.placeholder.com/30" class="rounded-full">
              Ustaz Sazali
            </td>
            <td class="text-red-600 font-semibold">DITOLAK</td>
            <td class="text-center">
              <button onclick="openModal('Ustaz Sazali','TVET TAHFIZ','2025-09-29','Memo pertandingan hafazan Negeri Melaka','Permohonan menggunakan Van Institut untuk menghantar pelajar tahfiz terpilih untuk menyertai pertandingan hafazan.','VAN Adtec',this)" class="text-blue-600 hover:text-blue-800">
                üëÅ
              </button>
            </td>
            <td>2025-09-29</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- popup detail -->
  <div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg p-6 w-[600px] relative">
      <button onclick="closeModal()" class="absolute top-2 right-2 text-xl font-bold text-black">‚úï</button>

      <h3 class="text-lg font-bold mb-4">Detail Permohonan</h3>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="font-bold">Nama:</label>
          <input id="modalNama" class="w-full border rounded px-2 py-1 bg-gray-50 cursor-default" readonly>
        </div>
        <div>
          <label class="font-bold">Tarikh Permohonan:</label>
          <input id="modalTarikh" class="w-full border rounded px-2 py-1 bg-gray-50 cursor-default" readonly>
        </div>
        <div>
          <label class="font-bold">Bahagian:</label>
          <input id="modalBahagian" class="w-full border rounded px-2 py-1 bg-gray-50 cursor-default" readonly>
        </div>
        <div>
          <label class="font-bold">Jenis Kenderaan:</label>
          <input id="modalKenderaan" class="w-full border rounded px-2 py-1 bg-gray-50 cursor-default" readonly>
        </div>
        <div class="col-span-2">
          <label class="font-bold">Memo:</label>
          <div class="flex items-center gap-2 bg-gray-50 border rounded px-2 py-1">
            <span id="modalMemo" class="flex-1 text-gray-700 select-none">-</span>
            <a id="memoDownload" href="#" download="memo.pdf" class="text-blue-600 hover:text-blue-800">‚¨á</a>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <label class="font-bold">Maklumat Permohonan:</label>
        <textarea id="modalMaklumat" class="w-full border rounded px-2 py-2 bg-gray-50 cursor-default" rows="4" readonly></textarea>
      </div>

      <div class="flex gap-4 justify-center">
        <button id="approveBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">LULUSKAN</button>
        <button id="rejectBtn" class="bg-gray-200 text-black px-4 py-2 rounded hover:bg-gray-300">TOLAK</button>
      </div>
    </div>
  </div>

  <!-- logout modal -->
  <div id="logoutModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="logoutTitle">
      <h3 id="logoutTitle">Sahkan Log Keluar</h3>
      <p>Adakah anda pasti mahu log keluar?</p>
      <div class="modal-actions">
        <button id="confirmLogout" class="btn primary">Ya, Log Keluar</button>
        <button id="cancelLogout" class="btn">Tidak</button>
      </div>
    </div>
  </div>

  <style>
    body {
      height: 100vh;
      width: 100%;
  background-image: url('../../../IMG/Bas4.jpg');
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      font-family: "Poppins", sans-serif;
    }
    .sidebar {
      position: fixed;top:0;left:0;width:260px;height:100%;
      background: rgba(255,255,255,0.2);backdrop-filter:blur(17px);
      border-right:1px solid rgba(255,255,255,0.7);
      display:flex;flex-direction:column;padding:20px 0;
    }
    .logo {display:flex;align-items:center;padding:0 20px;color:#000}
    .logo img{width:43px;border-radius:50%}
    .logo h2{font-size:1.15rem;font-weight:600;margin-left:15px}
    .links{list-style:none;padding:0 8px}
    .links li{display:flex;align-items:center;border-radius:4px;transition:background 0.3s;padding:10px}
    .links li:hover{cursor:pointer;background:rgba(0,0,0,0.05)}
    .links li span{padding-right:10px;font-size:24px;color:#000}
    .links li a{color:#000;text-decoration:none;font-weight:500;white-space:nowrap}
    .links li.active{background:#0734bb !important;border-left:4px solid #fff}
    .links li.active a,.links li.active span{color:#fff !important;font-weight:600}
    .bottom-links{margin-top:auto}
    .modal{display:none;position:fixed;inset:0;z-index:9999;align-items:center;justify-content:center}
    .modal[aria-hidden="false"]{display:flex}
    .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.45)}
    .modal-panel{position:relative;background:#fff;border-radius:10px;padding:18px 20px;box-shadow:0 8px 30px rgba(0,0,0,0.15);max-width:360px;width:90%;z-index:1;text-align:center}
    .btn{padding:8px 14px;border-radius:8px;border:1px solid #ccc;background:#f5f5f5;cursor:pointer}
    .btn.primary{background:#0c48fe;color:#fff;border-color:#0c48fe}
  </style>

  <script>
    // logout modal
    (function(){
      const logoutLink = document.querySelector('.logout-link a');
      if(!logoutLink) return;
      const modal = document.getElementById('logoutModal');
      const confirmBtn = document.getElementById('confirmLogout');
      const cancelBtn = document.getElementById('cancelLogout');

      logoutLink.addEventListener('click', function(e){
        e.preventDefault();
        modal.setAttribute('aria-hidden','false');
        modal.dataset.href = this.getAttribute('href') || '';
      });

      confirmBtn.addEventListener('click', function(){
        const href = modal.dataset.href || logoutLink.getAttribute('href');
        if(href) window.location.href = href;
        else modal.setAttribute('aria-hidden','true');
      });

      cancelBtn.addEventListener('click', closeLogout);
      modal.querySelector('.modal-backdrop').addEventListener('click', closeLogout);
      document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeLogout(); });

      function closeLogout(){ modal.setAttribute('aria-hidden','true'); modal.dataset.href = ''; }
    })();

    // popup notification
    let currentRow = null;

    function openModal(nama, bahagian, tarikh, memo, maklumat, kenderaan, btn) {
      document.getElementById('detailModal').classList.remove('hidden');
      document.getElementById('modalNama').value = nama;
      document.getElementById('modalBahagian').value = bahagian;
      document.getElementById('modalTarikh').value = tarikh;
      document.getElementById('modalMemo').innerText = memo;
      document.getElementById('modalMaklumat').value = maklumat;
      document.getElementById('modalKenderaan').value = kenderaan;
      document.getElementById('memoDownload').href = "data:application/pdf;base64,JVBERi0xLjQKJc..."; // dummy pdf
      currentRow = btn.closest("tr");
    }

    function closeModal() {
      if(currentRow){
        let statusCell = currentRow.querySelector("td:nth-child(2)");
        if(statusCell.innerText !== "DILULUSKAN" && statusCell.innerText !== "DITOLAK"){
          statusCell.innerText = "MENUNGGU";
          statusCell.className = "text-yellow-600 font-semibold";
        }
      }
      document.getElementById('detailModal').classList.add('hidden');
    }
 
    document.getElementById("approveBtn").addEventListener("click", function(){
      if(currentRow){
        let statusCell = currentRow.querySelector("td:nth-child(2)");
        statusCell.innerText = "DILULUSKAN";
        statusCell.className = "text-green-600 font-semibold";
        dimEye(currentRow);
        closeModal();
      }
    });

    document.getElementById("rejectBtn").addEventListener("click", function(){
      if(currentRow){
        let statusCell = currentRow.querySelector("td:nth-child(2)");
        statusCell.innerText = "DITOLAK";
        statusCell.className = "text-red-600 font-semibold";
        dimEye(currentRow);
        closeModal();
      }
    });

    function dimEye(row){
      let eyeBtn = row.querySelector("button");
      if(eyeBtn) eyeBtn.classList.add("opacity-50","cursor-not-allowed");
    }
  </script>
</body>
</html>
